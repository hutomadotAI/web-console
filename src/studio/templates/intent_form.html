{% extends 'studio_base.html' %}

{% load i18n widget_tweaks static %}

{% block title %}{% trans 'Bot intents' %} {{ intent_name }}{% endblock %}

{% block navigation %}
  {% include 'studio_navigation.html' with ai=ai active='intents' %}
{% endblock %}

{% block content %}
  <div class="content-wrapper">

    <div class="box">
      <div class="box-header with-border">

        <h2 class="box-title">
          <i class="fa fa-commenting-o text-green"></i>
            {% if intent_name %}
              {% trans 'Edit' %} {{ intent_name }}
            {% else %}
              {% trans 'Create Intent' %}
            {% endif %}
        </h2>

        <a href="https://help.hutoma.ai/article/11n0g7gjv1-adding-simple-intents-mapping-questions-and-answers"
          class="documentation link"
          target="_blank"
          data-toggle="tooltip"
          title="{% trans 'Documentation' %}">
            <i class="fa fa-question-circle"></i>
        </a>

      </div>

      <div class="box-body">

        <form method="post" class="persistent" id="INTENT_FORM">
          {% csrf_token %}

          {% for hidden in form.hidden_fields %}
            {{ hidden }}
          {% endfor %}

          {% include 'forms/field.html' with field=form.intent_name %}

          <hr/>

          <h5>

            <button class="text advanced-toggle {% if not formsets.conditions.forms|length %}collapsed{% endif %}"
              tabindex="-1"
              type="button"
              data-toggle="collapse"
              data-target="#CONDITIONS">{% trans 'Conditions' %}</button>

            <a href="#"
              class="fa fa-question-circle"
              target="_blank"
              data-toggle="tooltip"
              title="{% trans 'Documentation' %}"></a>

          </h5>

          <div id="CONDITIONS" class="form-section collapse {% if formsets.conditions.forms|length %}show{% endif %}">

            <div class="alert alert-info">
              {% blocktrans %}
                Fire this intent when a human says input occurs and all of these conditions are true.
              {% endblocktrans %}
            </div>

            <div class="formset" id="CONDITIONS_FORMSET">

              {% for form in formsets.conditions.forms %}

                {% include 'formset.html' with formset='CONDITIONS' id=forloop.counter0 fields=form %}

                {{ form.errors }}

              {% endfor %}

              {{ formsets.conditions.management_form }}

            </div>

            <button class="btn btn-success formset-button" data-toggle="tooltip" type="button"
              title="{% trans 'Add a new Condition' %}"
              data-formset="CONDITIONS">{% trans 'Add Condition' %}</button>

            {% include 'forms/field.html' with field=form.conditions_default_response %}

          </div>

          <hr/>

          <h5>
            <span class="text">{% trans 'Dialog' %}</span>
          </h5>

          {% include 'forms/field.html' with field=form.user_says %}

          {% include 'forms/field.html' with field=form.responses %}

          <hr/>

          <h5>

            <button class="text advanced-toggle {% if not formsets.context_in.forms|length %}collapsed{% endif %}"
              tabindex="-1"
              type="button"
              data-toggle="collapse"
              data-target="#CONTEXT_IN">{% trans 'Memory variables' %}</button>

            <a href="https://help.hutoma.ai/article/xc5zkhbg3a-adding-entities"
              class="fa fa-question-circle"
              target="_blank"
              data-toggle="tooltip"
              title="{% trans 'Documentation' %}"></a>

          </h5>

          <div id="CONTEXT_IN" class="form-section collapse {% if formsets.context_in.forms|length %}show{% endif %}">

            <div class="alert alert-info">
              {% blocktrans %}
                Assign those memory variables when this intent is being triggered.
              {% endblocktrans %}
            </div>

            <div class="formset" id="CONTEXT_IN_FORMSET">

              {% for form in formsets.context_in.forms %}

                {% include 'formset.html' with formset='CONTEXT_IN' id=forloop.counter0 fields=form %}

                {{ form.errors }}

              {% endfor %}

              {{ formsets.context_in.management_form }}

            </div>

            <button class="btn btn-success formset-button" data-toggle="tooltip" type="button"
              title="{% trans 'Add a new variable' %}"
              data-formset="CONTEXT_IN">{% trans 'Add variable' %}</button>

          </div>

          <hr/>

          <h5>

            <button class="text advanced-toggle {% if not entities_formset.forms|length %}collapsed{% endif %}"
              tabindex="-1"
              type="button"
              data-toggle="collapse"
              data-target="#ENTITIES">{% trans 'Entities' %}</button>

            <a href="#"
              class="fa fa-question-circle"
              target="_blank"
              data-toggle="tooltip"
              title="{% trans 'Documentation' %}"></a>

          </h5>

          <div id="ENTITIES" class="form-section collapse {% if formsets.entities.forms|length %}show{% endif %}">

            <div class="formset" id="ENTITIES_FORMSET">

              {% for form in formsets.entities.forms %}

                {% include 'formset.html' with formset='ENTITIES' id=forloop.counter0 fields=form %}

                {{ form.errors }}

              {% endfor %}

              {{ formsets.entities.management_form }}

            </div>

            <button class="btn btn-success formset-button" data-toggle="tooltip" type="button"
              title="{% trans 'Add a new Entity' %}"
              data-formset="ENTITIES">{% trans 'Add Entity' %}</button>

          </div>

          <hr/>

          <h5>

            <button class="text advanced-toggle {% if not form.webhook.value %}collapsed{% endif %}"
              tabindex="-1"
              type="button"
              data-toggle="collapse"
              data-target="#WEBHOOK">{% trans 'Webhook' %}</button>

            <a href="#"
              class="fa fa-question-circle"
              target="_blank"
              data-toggle="tooltip"
              title="{% trans 'Documentation' %}"></a>

          </h5>

          <div id="WEBHOOK" class="form-section collapse {% if form.webhook.value %}show{% endif %}">

            {% include 'forms/field.html' with field=form.webhook %}

          </div>

          <hr/>

          <h5>

            <button class="text advanced-toggle {% if not formsets.context_out.forms|length %}collapsed{% endif %}"
              tabindex="-1"
              type="button"
              data-toggle="collapse"
              data-target="#CONTEXT_OUT">{% trans 'Context out' %}</button>

            <a href="#"
              class="fa fa-question-circle"
              target="_blank"
              data-toggle="tooltip"
              title="{% trans 'Documentation' %}"></a>

          </h5>

          <div id="CONTEXT_OUT" class="form-section collapse {% if formsets.context_in.forms|length %}show{% endif %}">

            <div class="alert alert-info">
              {% blocktrans %}
                Assign those memory variables when this intent is being triggered.
              {% endblocktrans %}
            </div>

            <div class="formset" id="CONTEXT_OUT_FORMSET">

              {% for form in formsets.context_out.forms %}

                {% include 'formset.html' with formset='CONTEXT_OUT' id=forloop.counter0 fields=form %}

                {{ form.errors }}

              {% endfor %}

              {{ formsets.context_out.management_form }}

            </div>

            <button class="btn btn-success formset-button" data-toggle="tooltip" type="button"
              title="{% trans 'Add a new variable' %}"
              data-formset="CONTEXT_OUT">{% trans 'Add variable' %}</button>

            {% include 'forms/checkbox.html' with field=form.reset_context_on_exit %}

          </div>

        </form>

        <script id="CONDITIONS_TEMPLATE" type="text/template">
          {% include 'formset.html' with formset='CONDITIONS' id='__prefix__' fields=formsets.conditions.empty_form  %}
        </script>

        <script id="ENTITIES_TEMPLATE" type="text/template">
          {% include 'formset.html' with formset='ENTITIES' id='__prefix__' fields=formsets.entities.empty_form  %}
        </script>

        <script id="CONTEXT_IN_TEMPLATE" type="text/template">
          {% include 'formset.html' with formset='CONTEXT_IN' id='__prefix__' fields=formsets.context_in.empty_form  %}
        </script>

        <script id="CONTEXT_OUT_TEMPLATE" type="text/template">
          {% include 'formset.html' with formset='CONTEXT_OUT' id='__prefix__' fields=formsets.context_out.empty_form  %}
        </script>

      </div>

      <div class="box-footer">

        <p>
          {% blocktrans %}If youâ€™re stuck check out our <a data-toggle="modal" data-target="#INTENTS_VIDEO_TUTORIAL">intents video tutorial</a>{% endblocktrans %}
        </p>

        <button form="INTENT_FORM" formaction="?next=studio:intents.add" class="btn btn-default">{% trans 'Save and add new intent' %}</button>

        <button form="INTENT_FORM" class="btn btn-primary">{% trans 'Save' %}</button>

      </div>

    </div>

  </div>

{% endblock %}

{% block modals %}

  {% trans 'Intents video tutorial' as title %}
  {% include 'modals/video_tutorial.html' with id='INTENTS_VIDEO_TUTORIAL' title=title slug='SI5XgQm660A' %}

{% endblock modals %}

{% block stylesheets.vendors %}
  {{ block.super }}

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/bootstrap-tokenfield.min.css" integrity="sha256-4qBzeX420hElp9/FzsuqUNqVobcClz1BjnXoxUDSYQ0=" crossorigin="anonymous">
{% endblock %}

{% block stylesheets %}
  {{ block.super }}

  <link rel="stylesheet" href="{% static 'css/intents.css' %}">
  <link rel="stylesheet" href="{% static 'css/formset.css' %}">
  <link rel="stylesheet" href="{% static 'css/tokenfield.css' %}">
{% endblock %}

{% block javascripts.vendors %}
  {{ block.super }}

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.min.js" integrity="sha256-jdwX0QzXB7z7Xc7Vz0ovtIHWO5qIZWg0aLcGv44JDgE=" crossorigin="anonymous"></script>
{% endblock %}

{% block javascripts %}
  {{ block.super }}

  <script src="{% static 'js/formset.js' %}"></script>
  <script src="{% static 'js/tokenfield.js' %}"></script>

{% endblock %}
