{% extends 'studio_base.html' %}

{% load i18n crispy_forms_tags static %}

{% block title %}{% trans 'Bot Settings' %}{% endblock %}

{% block navigation %}
  {% include 'studio_navigation.html' with ai=ai active='settings' %}
{% endblock %}

{% block content %}
  <div class="content-wrapper">

    <div class="box">
      <div class="box-header with-border">
        <h2 class="box-title"><i class="fa fa-gear text-red"></i> {% trans 'Basic Bot Settings' %}</h2>
      </div>

      <div class="box-body">

        <form method="post" class="persistent" id="SETTINGS_FORM">
          {% csrf_token %}

          {{ form | crispy }}

        </form>

      </div>

      <div class="box-footer">
        <a href="{% url 'studio:proxy.ai.export' ai.aiid %}" class="btn btn-primary" download="bot-{{ ai.aiid }}.json" >{% trans 'Export bot' %}</a>
        <button type="submit" form="SETTINGS_FORM" class="btn btn-success">{% trans 'Save' %}</button>
      </div>

    </div>

    <div class="box">

      <div class="box-header with-border">
        <h2 class="box-title">{% trans 'API tokens' %}</h2>
      </div>

      <div class="box-body">

        <div class="form-group">
          <label for="DEV_ID">{% trans 'Developer ID (private)' %}</label>
          <div class="input-group">
            <input class="form-control" readonly id="DEV_ID" value="{{ request.session.dev_id }}">
            <div class="input-group-append">
              <button class="btn btn-default fa fa-clipboard" data-toggle="tooltip" title="{% trans 'Copy to clipboard' %}" data-clipboard-target="#DEV_ID">
                <span class="sr-only">{% trans 'Copy to clipboard' %}</span>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="DEV_TOKEN">{% trans 'Dev token (private)' %}</label>
          <div class="input-group">
            <input class="form-control" readonly id="DEV_TOKEN" value="{{ request.session.token }}">
            <div class="input-group-append">
              <button class="btn btn-default fa fa-clipboard"
                data-toggle="tooltip"
                title="{% trans 'Copy to clipboard' %}"
                data-clipboard-target="#DEV_TOKEN">
                <span class="sr-only">{% trans 'Copy to clipboard' %}</span>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="CLIENT_TOKEN">{% trans 'Client token (public)' %}</label>
          <div class="input-group">
            <input class="form-control" readonly id="CLIENT_TOKEN" value="{{ ai.client_token }}">
            <div class="input-group-append">
              <button class="btn btn-default fa fa-clipboard"
                data-toggle="tooltip"
                title="{% trans 'Copy to clipboard' %}"
                data-clipboard-target="#CLIENT_TOKEN">
                <span class="sr-only">{% trans 'Copy to clipboard' %}</span>
              </button>
            </div>
          </div>
        </div>

      </div>

    </div>

    <div class="box box-danger">
      <div class="box-header with-border">
        <h2 class="box-title">{% trans 'Danger zone' %}</h2>
      </div>

      <div class="box-body">

        <div class="alert alert-info">
          {% blocktrans %}If you change any of those settings it can break your
          bot, there is no going back. Please be certain.{% endblocktrans %}
        </div>

        <div class="form-webhook">

          <div class="form-group">
            <label for="WEBHOOK_SIGNING_SECRET">{% trans 'Webhook signing secret' %}</label>
            <div class="input-group">
              <input type="text" readonly class="textinput textInput form-control" id="WEBHOOK_SIGNING_SECRET">
              <div class="input-group-append">
                <button class="btn btn-default fa fa-clipboard"
                  data-toggle="tooltip"
                  title="{% trans 'Copy to clipboard' %}"
                  data-clipboard-target="#WEBHOOK_SIGNING_SECRET">
                  <span class="sr-only">{% trans 'Copy to clipboard' %}</span>
                </button>
              </div>
            </div>
          </div>

          <div class="form-group">
            <button data-toggle="modal" data-target="#regenerate_webhook_secret" class="btn btn-primary pull-right">{% trans 'Generate' %}</button>
          </div>

        </div>

      </div>

      <div class="box-footer">
        <button data-toggle="modal" data-target="#delete_AI" class="btn btn-danger">{% trans 'Delete bot' %}</button>
      </div>

    </div>

  </div>
{% endblock %}

{% block modals %}
  {% include 'modals/delete_ai.html' with id='delete_AI' %}
  {% include 'modals/regenerate_webhook_secret.html' with id='regenerate_webhook_secret' %}
{% endblock %}

{% block stylesheets.vendors %}
  {{ block.super }}

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/bootstrap-tokenfield.min.css" integrity="sha256-4qBzeX420hElp9/FzsuqUNqVobcClz1BjnXoxUDSYQ0=" crossorigin="anonymous" />
{% endblock %}

{% block stylesheets %}
  {{ block.super }}

  <link rel="stylesheet" href="{% static 'css/tokenfield.css' %}">
  <link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block javascripts.vendors %}
  {{ block.super }}

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.min.js" integrity="sha256-jdwX0QzXB7z7Xc7Vz0ovtIHWO5qIZWg0aLcGv44JDgE=" crossorigin="anonymous"></script>
{% endblock %}

{% block javascripts %}
  {{ block.super }}

  <script src="{% static 'js/tokenfield.js' %}"></script>
  <script src="{% static 'js/webhook.js' %}"></script>
{% endblock %}
